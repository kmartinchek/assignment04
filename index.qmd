---
title: "Data Science for Public Policy"
subtitle: "Data Visualization, Quarto, and Git"
author: "Kassandra Martinchek - KM1775"
format: html
editor: visual
---

## Project Introduction

This data project explores trends in credit and debt in U.S. states in February 2020. The goal of this project is to understand disparities in credit health between states and communities and explore the potential implications of policies designed to strengthen consumer credit health.

## Data Details

This project uses data from the Urban Institute's "Credit Health during the COVID-19 Pandemic" data feature. This data is from a 2 percent random sample of deidentified consumer credit records from one of the main three credit bureaus linked to information on alternative financial service loans (such as payday, pawn shop, and auto title loans) from a Fair Credit Reporting Act regulated agency.

Citation: Kassandra Martinchek, Alex Carther, Breno Braga, Caleb Quakenbush, and Signe-Mary McKernan. 2022. Credit Health during the COVID-19 Pandemic Dataset. Urban Institute. Accessible from https://datacatalog.urban.org/dataset/credit-health-during-covid-19-pandemic

Hyperlink: https://datacatalog.urban.org/dataset/credit-health-during-covid-19-pandemic/resource/0f812245-6b99-4f13-b7e2-e3398a7dc10b 

## Clean and Prepare the Data for Visualization

```{r}

# load in relevant libraries for analysis
library(readxl)
library(tidyverse)
library(stringr)
library(urbnthemes)

# load in the data
credit_feb20 <- read_excel("data/covidcredithealth_state.xlsx", sheet = "State 2020_02")

# inspect the data and note that these are character strings because of n/a values
head(credit_feb20)

# rename column names to be snake case for analysis
colnames(credit_feb20) <- c("state", "subprime_a", "subprime_c", "subprime_w", "collections_a", "collections_c", "collections_w", "med_debt_a", "med_debt_c", "med_debt_w", "cred_use_a", "cred_use_c", "cred_use_w", "stud_del_a", "stud_del_c", "stud_del_w", "cred_del_a", "cred_del_c", "cred_del_w", "auto_del_a", "auto_del_c", "auto_del_w", "mort_del_a", "mort_del_c", "mort_del_w", "afs_use_a", "afs_use_c", "afs_use_w", "afs_del_a", "afs_del_c", "afs_del_w", "score_a", "score_c", "score_w", "mmed_a", "mmed_c", "mmed_w", "medical_a", "medical_c", "medical_w")

# replace n/a values in strings
credit_feb20 <- credit_feb20 %>%
  mutate(across(.cols = everything(), .fns = ~str_replace(., "n/a", ""))) 

# remove $ from median debt variables
credit_feb20 <- credit_feb20 %>%
  mutate(med_debt_a = str_remove(string = med_debt_a, pattern = "\\$")) %>%
  mutate(med_debt_c = str_remove(string = med_debt_c, pattern = "\\$")) %>%
  mutate(med_debt_w = str_remove(string = med_debt_w, pattern = "\\$")) %>%
  mutate(mmed_a = str_remove(string = mmed_a, pattern = "\\$")) %>%
  mutate(mmed_c = str_remove(string = mmed_c, pattern = "\\$")) %>%
  mutate(mmed_w = str_remove(string = mmed_w, pattern = "\\$")) 

# make string data numeric
credit_feb20 <- credit_feb20 %>%
  mutate(across(.cols = !state, .fns = ~as.numeric(.))) 

# add in the Census regions of the US to the data
# reference to Census regions here: https://www2.census.gov/geo/pdfs/maps-data/maps/reference/us_regdiv.pdf

credit_feb20 <- credit_feb20 %>%
  mutate(region = case_when(state == "CT" | state == "ME" | state == "MA" | state == "NH" | state == "RI" | state == "VT" | state == "NJ" | state == "NY" | state == "PA" ~ "northeast",
                            state == "IN" | state == "IL" | state == "MI" | state == "OH" | state == "WI" | state == "IA" | state == "KS" | state == "MN" | state == "MO" | state == "NE" | state == "ND" | state == "SD" ~ "midwest", 
                            state == "DE" | state == "DC" | state == "FL" | state == "GA" | state == "MD" | state == "NC" | state == "SC" | state == "VA" | state == "WV" | state == "AL" | state == "KY" | state == "MS" | state == "TN" | state == "AR" | state == "LA" | state == "OK" | state == "TX" ~ "south",
                            state == "AZ" | state == "CO" | state == "ID" | state == "NM" | state == "MT" | state == "UT" | state == "NV" | state == "WY" | state == "AK" | state == "CA" | state == "HI" | state == "OR" | state == "WA" ~ "west"))

         
```

## Visualization 1: Do States with Consumers Who Use More Payday Loans Have More Trouble Repaying Loans?

```{r}

# mapping AFS use against AFS delinquencies

credit_feb20 %>%
  ggplot() +
  geom_point(mapping = aes(x = afs_use_a, y = afs_del_a, shape = region), color = "#1696d2", size = 2)  +
  scale_x_continuous(limits = c(0, 10)) +
  scale_y_continuous(limits = c(0, 40)) +
  geom_smooth(method = lm, mapping = aes(x = afs_use_a, y = afs_del_a), color = "#fdbf11", linetype = "solid") +
  labs(
    shape = "Census Region",
    title = "States With More AFS Use Experience Greater Delinquencies",
    subtitle = "AFS Use and AFS Delinquencies by State, February 2020",
    caption = "Data Source: Kassandra Martinchek, Alex Carther, Breno Braga, Caleb Quakenbush, and Signe-Mary McKernan. 2022. Credit Health during the COVID-19 Pandemic Dataset. Urban Institute. Accessible from https://datacatalog.urban.org/dataset/credit-health-during-covid-19-pandemic",
    x = "Share of Consumers Using AFS",
    y = "Share of Consumers With AFS Delinquencies"
  ) 
         
```

This visualization shows the relationship between use of alternative financial services (AFS) and AFS delinquency rates. We see in Visualization 1 see that there is a slight positive relationship between AFS use and AFS delinquency across Census regions, where states with more consumers who use AFS services also exhibit higher AFS delinquency rates. Scholars and policymakers are concerned about how AFS use impacts consumers' financial health, given research that points to AFS use negatively impacting mental and physical health, bankruptcy, and consumers' ability to repay loans (Bhutta et al., 2016; Eisenberg-Guyot et al., 2018; Skiba & Tobacman, 2019). Consequently, policymakers have increasingly pursued policies that regulate the interest rates that lenders can charge consumers, with the goal of reducing AFS use. Visualization 1 suggests that these efforts may be associated with a reduction in AFS delinquencies, thus improving consumer's credit health as they may no longer struggle to repay high-cost loans (like AFS).

Citations:
Bhutta, N., Goldin, J., & Homonoff, T. (2016). Consumer borrowing after payday loan bans. The Journal of Law and Economics, 59(1), 225-259.

Eisenberg-Guyot, J., Firth, C., Klawitter, M., & Hajat, A. (2018). From payday loans to pawnshops: Fringe banking, the unbanked, and health. Health Affairs, 37(3), 429-437.

Skiba, P. M., & Tobacman, J. (2019). Do payday loans cause bankruptcy?. The Journal of Law and Economics, 62(3), 485-519.

## Visualization 2: Do Communities of Color Have Poorer Credit Than Majority-White Communities in the DMV?

```{r}

# filter data to states in the DMV
 dmv_credit <- credit_feb20 %>%
  filter(state == "DC" | state == "MD" | state == "VA") %>%
  select(state, subprime_a, subprime_c, subprime_w)

# transform data set from wide to long for visualization
 
  viz2 <- pivot_longer(
    data = dmv_credit,
    cols = c(subprime_a, subprime_c, subprime_w),
    names_to = "community",
    values_to = "share"
  )

# recode community variable for visualization
  viz2 <- viz2 %>%
  mutate(community = case_when(community == "subprime_a" ~ "all",
                               community == "subprime_c" ~ "comm col",
                               community == "subprime_w" ~ "white"))

# stacked bar chart for each state
  viz2 %>%
    ggplot(aes(x = state, y = share, fill = community)) +
    geom_bar(position = "dodge", stat = "identity") +
    scale_fill_discrete(name = "Community", labels = c("All Communities", "Communities of Color", "Majority White Communities")) +
    coord_flip() +
    theme(legend.position = "top") +
    geom_text(aes(label = share), position = position_dodge(width = 1), hjust = -0.2, size = 3) +
    labs(
    title = "Communities of Color in the District Have Poorer Credit Health",
    subtitle = "Share of Consumers with Subprime Credit Scores by Community in Maryland, DC, and Virginia, February 2020",
    caption = "Data Source: Kassandra Martinchek, Alex Carther, Breno Braga, Caleb Quakenbush, and Signe-Mary McKernan. 2022. Credit Health during the COVID-19 Pandemic Dataset. Urban Institute. Accessible from https://datacatalog.urban.org/dataset/credit-health-during-covid-19-pandemic",
    x = "State",
    y = "Share of Consumers With Subprime Credit Scores"
  ) 
    
         
```

This visualization shows how credit health, as measured by the share of consumers with subprime credit, varies among communities in the DMV. Consumers with subprime credit, or credit scores below 600, pay more to borrow funds and have constrained access to low cost credit. We see in Visualization 2 that communities of color in DC, Maryland, and Virginia have higher shares of consumers with subprime credit relative to majority-white communities. This finding reflects a history of structural racism in credit access that has persisted to present day (Kijakazi et al., 2019). Consequently, policymakers interested in addressing disparities in credit health that persist across communities  need to consider policies that explicitly address racial disparities. 

Citations:
Kijakazi, K., Brown, S., Charleston, D., & Runes, C. (2019). Next50 Catalyst Brief: Structural Racism. Urban Institute.
